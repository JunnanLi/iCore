# iCore项目
in-line FPGA-CPU协同分组处理

## Hardware部分
硬件文件夹包含x个文件，功能如下表所示

| 文件名 | 功能描述 |
|-----------|----------------------|
| TuMan_core.v  |  10级流水RISCV核 |
| TuMan_top.v   |  CPU核顶层文件，连接CPU核和存储器 |
| memory.v      |  指令存储器（即ITCM）和数据存储器（即DTCM） |
| conf_mem.v    |  通过报文配置ITCM和DTCM，其中以太网协议字段为0x9001-0x9004，以及输出程序中的"printf"内容，以太网协议字段为0x9005 |
| um.v | A top file of [FAST program](http://www.fastswitch.org/) (an open source object), used to connect ITCM/DTCM and CPU |
| gen_data_instr.v |  Read binary program from firmware.hex, and generate Ethernet packets in FAST format to configure ITCM and DTCM |
| testbench_for_P2RV.v |  A testbench for this project |
| firmware.hex |  binary file i.e., firmware.hex, generated by risc-tools (currently, we do only support RISCV-32I) |

## Software part
There are 2 floders in "Software" folder:

| Folder name | Function description |
|-------------|----------------------|
| firmware    | generate firmware.hex|
| controller  | communicate with cpu |

## Simulation
### Steps
1) Generating firmware.hex by using commonds in firmware folder
2) Using vivado/Modesim to simulate these project by loading hardware files and firmware.hex

### Result
Run this program, and you will get following result: "Hello, AoTuman!"

## FPGA Emulation
We currently only provide support for the [OpenBox-S4](https://github.com/fast-codesign/FAST-OpenBox_S4-impl). We provide pre-build binary program and bitstream files for OpenBox-S4 [here](https://github.com/JunnanLi/TuMan/tree/master/mcs%26hex).  
### Generating binary program
We use commonds in firmware folder to Generate firmware.hex

### Generating bitstream
First, we need a typical [OpenBox-S4 project](https://github.com/fast-codesign/FAST-OpenBox_S4-impl), and replace the `um.v` with our `um.v`.
Then, we add our ohter hardware verilog files, i.e., `TuMan_core.v`, `TuMan_top.v`, `conf_mem.v` and `memory.v`.
Third, we use Vivado 2018.2. to generate bitstream, i.e., OpenBox_S4.bit.

### Communicate with CPU
We use commonds in controller folder to communicate with CPU

### Result
We can recieve values returned from CPU by run t_recv:  
>>interface: enp0s31f6  
>>dtcm_sel is 0  
>>dtcm_sel is 1  
>>  
>>===============  
>>Hello, AoTuman!  
>>\===============  
>>  
>>DONE  
